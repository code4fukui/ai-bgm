<html>
<head>
  <!-- You need to bring your own Tone.js for the player, and tfjs for the model -->
<!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.58/Tone.js"></script>-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/1.2.8/tf.min.js"></script>
  <!-- Core library, since we're going to use a player -->
  <script src="https://cdn.jsdelivr.net/npm/@magenta/music@^1.0.0/es6/core.js"></script>
  <!--Model we want to use -->
  <script src="https://cdn.jsdelivr.net/npm/@magenta/music@^1.0.0/es6/music_vae.js"></script>
</head>
<button id=btn>play</button>
<script type="module">
  import { SAD, HAPPY } from "./melody.js";
  //import { melodies } from "./melodies.js"; // pre build?

  // https://magenta.github.io/magenta-js/music/index.html
  btn.onclick = async () => {
    // Each bundle exports a global object with the name of the bundle.
    //const player = new core.Player();


    const url = 'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/mel_2bar_small';
    //const url = 'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/mel_16bar_small_q2'; // https://raw.githubusercontent.com/StephenHaney/dear-diary-ai/develop/src/components/GenerateMelodies.tsx
    //const url = 'https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/trio_4bar';
    const mvae = new music_vae.MusicVAE(url);
    await mvae.initialize();

    /*
    const sequences = core.sequences;
    const quantizedHappy = sequences.quantizeNoteSequence(HAPPY, 4);
    const quantizedSad = sequences.quantizeNoteSequence(SAD, 4);
    const melodies = await mvae.interpolate([quantizedSad, quantizedHappy], 20);
    */
    const melodies = await mvae.sample(4);
    //const melodies = await mvae.interpolate([SAD, HAPPY], 20);
    //await player.start(SAD);
    //await player.start(HAPPY);
    console.log(melodies);
    
    /*
    for (const melody of melodies) {
      await player.start(melody);
    }


    for (let i = 0;; i++) {
      const samples = await mvae.sample(4);
      let j = 1;
      for (const sample of samples) {
        console.log(i, j++);
        await player.start(sample);
      }
    }
    */
    /*
    const samples = await mvae.sample(2);
    for (const sample of samples) {
      await player.start(sample);
    }
    */
  };
</script>
</html>
